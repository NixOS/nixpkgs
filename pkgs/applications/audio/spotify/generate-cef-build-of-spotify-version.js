// generate-cef-build-of-spotify-version.js
// 1. open https://www.spotify.com/ps-en/opensource/
// 2. copy this script to the javascript console

var i = '      '; // indent
var lastBuild = null; var lastVersion = null; var cefBuildOfVersion = {};
console.log(
  i + '# generated by generate-cef-build-of-spotify-version.js\n' +
  i + 'cef-version-of-spotify-version = {' +
  Array.from(document.querySelectorAll('#content-main > div > div > table > tbody > tr')) //.slice(0, 2) // debug
  .map(tr => {
    const td = tr.children;
    const spotifyVersion = td[0].innerHTML.match(/^([^.]+\.[^.]+\.[^.]+)\..+/)[1];
    const cefBuild = td[1].children[0].innerHTML;
    const cefVersion = cefBuild.split('+')[0];
    let res = '';
    if (lastVersion != spotifyVersion && cefBuild.match(/\+chromium-/)) {
      cefBuildOfVersion[cefVersion] = cefBuild;
      res = (lastBuild == cefBuild ? ' ' : ('\n  ' + i)) + `"${spotifyVersion}" = "${cefVersion}";`;
    }
    lastBuild = cefBuild; lastVersion = spotifyVersion;
    return res;
  }).join('') +
  '\n' +
  i + '};\n\n' +
  i + '# generated by generate-cef-build-of-spotify-version.js\n' +
  i + 'cef-build-of-cef-version = {\n' +
  Object.entries(cefBuildOfVersion).map(([cefVersion, cefBuild]) => (
    `${i}  "${cefVersion}" = "${cefBuild}";`
  )).join('\n') +
  '\n' +
  i + '};'
);
