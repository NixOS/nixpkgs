{ lib
, buildGoModule
, fetchFromGitHub
}:

buildGoModule rec {
  pname = "zgrab2";
<<<<<<< HEAD
  version = "unstable-2023-03-23";
=======
  version = "20210327-${lib.strings.substring 0 7 rev}";
  rev = "17a5257565c758e2b817511d15476d330be0a17a";
>>>>>>> 903308adb4b (Improved error handling, differentiate nix/non-nix networks)

  src = fetchFromGitHub {
    owner = "zmap";
    repo = pname;
<<<<<<< HEAD
    rev = "911c86f13080ceae98f8d63d1ae0e85c4a8f7f61";
    hash = "sha256-VOWkBM/SziY3jiIaYYWq+LRzG4vKitiscqdIDfRUkYY=";
  };

  vendorHash = "sha256-Q3FCqvh4vn64QXqcePhVWTyIHJarI6I4YonH3X/7RhI=";

  patches = [
    # Without this, we get error messages like:
    # vendor/golang.org/x/sys/unix/syscall.go:83:16: unsafe.Slice requires go1.17 or later (-lang was set to go1.16; check go.mod)
    # The patch was generated by changing "go 1.12" to "go 1.17" and executing `go mod tidy -compat=1.17`.
    ./fix-go-version-error.patch
  ];

  subPackages = [
    "cmd/zgrab2"
  ];
=======
    inherit rev;
    sha256 = "1hxk2jggj8lww97lwmks46i001p5ycnxnck8yya6d0fd3ayxvw2w";
  };

  vendorSha256 = "1s0azy5b5hi5h24vs6a9f1n70l980vkid28ihqh10zq6ajmds2z3";

  subPackages = [ "cmd/zgrab2" ];
>>>>>>> 903308adb4b (Improved error handling, differentiate nix/non-nix networks)

  meta = with lib; {
    description = "Web application scanner";
    homepage = "https://github.com/zmap/zgrab2";
    license = with licenses; [ asl20 isc ];
<<<<<<< HEAD
    maintainers = with maintainers; [ fab juliusrickert ];
=======
    maintainers = with maintainers; [ fab ];
>>>>>>> 903308adb4b (Improved error handling, differentiate nix/non-nix networks)
  };
}
