# This file was auto-generated by cabal2nix. Please do NOT edit manually!
# This file was later edited to add patches, disable testing.
# Also patch the profile config to point to the ihaskell kernel exe

{ cabal, aeson, base64Bytestring, cereal, classyPrelude, cmdargs
, filepath, ghcParser, ghcPaths, haskeline, haskellSrcExts, here
, hlint, hspec, HTTP, HUnit, MissingH, monoTraversable, mtl, parsec
, random, setenv, shelly, split, stm, strict, systemArgv0
, systemFilepath, tar, text, transformers, unorderedContainers
, utf8String, uuid, vector, zeromq4Haskell, fetchpatch
}:

cabal.mkDerivation (self: {
  pname = "ihaskell";
  version = "0.4.2.0";
  sha256 = "012rmasdc167w6gl18ysr53737j4p4afk0qcsv81hif92vvg5j1c";
  isLibrary = true;
  isExecutable = true;
  patches = [ (fetchpatch { url = "https://github.com/gibiansky/IHaskell/pull/296.patch"; sha256 = "1h9gxq9l3j949prcwqkdkrc3q3sxai4b345hfp5hfi0mhfbysfn6"; }) ];
  prePatch = ''
    tar xvf profile/profile.tar -C profile
    sed -i -e '1iexe = "'$out'/bin/IHaskell".replace(" ", "\\ ")\' profile/ipython_config.py
  '';
  doCheck = false;
  buildDepends = [
    aeson base64Bytestring cereal classyPrelude cmdargs filepath
    ghcParser ghcPaths haskeline haskellSrcExts here hlint hspec HTTP
    HUnit MissingH monoTraversable mtl parsec random shelly split stm
    strict systemArgv0 systemFilepath tar text transformers
    unorderedContainers utf8String uuid vector zeromq4Haskell
  ];
  testDepends = [ # let's keep these anyway
    aeson base64Bytestring cereal classyPrelude cmdargs filepath
    ghcParser ghcPaths haskeline haskellSrcExts here hlint hspec HTTP
    HUnit MissingH monoTraversable mtl parsec random setenv shelly
    split stm strict systemArgv0 systemFilepath tar text transformers
    unorderedContainers utf8String uuid vector zeromq4Haskell
  ];
  postInstall = ''
    patchShebangs .
  '';
  jailbreak = true;
  meta = with self.stdenv.lib; {
    homepage = "http://gibiansky.github.io/IHaskell/";
    description = "A Haskell backend kernel for the IPython project";
    license = licenses.mit;
    platforms = self.ghc.meta.platforms;
    hydraPlatforms = self.stdenv.lib.platforms.none;
    maintainers = with maintainers; [ edwtjo ];
  };
})
