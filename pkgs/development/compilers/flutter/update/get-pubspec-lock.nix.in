{
  flutterPackages,
  stdenv,
  cacert,
  writableTmpDirAsHomeHook,
}:
let
  flutterCompactVersion = "@flutter_compact_version@";
  inherit (flutterPackages."v${flutterCompactVersion}") dart;
in
stdenv.mkDerivation (finalAttrs: {
  name = "pubspec-lock";
  src = @flutter_src@;

  sourceRoot = "${finalAttrs.src.name}/packages/flutter_tools";

  nativeBuildInputs = [
    dart
    writableTmpDirAsHomeHook
  ];

  outputHashAlgo = "sha256";
  outputHashMode = "recursive";
  outputHash = "@hash@";

  buildPhase = ''
    runHook preBuild

    dart --root-certs-file=${cacert}/etc/ssl/certs/ca-bundle.crt pub get -verbose

    runHook postBuild
  '';

  installPhase = ''
    runHook preInstall

    cp pubspec.lock $out

    runHook postInstall
  '';
})
