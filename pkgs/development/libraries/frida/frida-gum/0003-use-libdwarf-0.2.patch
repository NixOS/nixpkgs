From 6ba74e6a06602487e301d2681af1d93615493e6f Mon Sep 17 00:00:00 2001
From: Milan Hauth <milahu@gmail.com>
Date: Wed, 1 Feb 2023 12:46:43 +0100
Subject: [PATCH 3/5] use libdwarf 0.2

---
 gum/backend-libdwarf/gumsymbolutil-libdwarf.c | 13 +------------
 meson.build                                   |  2 +-
 2 files changed, 2 insertions(+), 13 deletions(-)

diff --git a/gum/backend-libdwarf/gumsymbolutil-libdwarf.c b/gum/backend-libdwarf/gumsymbolutil-libdwarf.c
index b64438da..65d9a949 100644
--- a/gum/backend-libdwarf/gumsymbolutil-libdwarf.c
+++ b/gum/backend-libdwarf/gumsymbolutil-libdwarf.c
@@ -555,17 +555,6 @@ gum_module_entry_from_path_and_base (const gchar * path,
   }
 
   dbg = NULL;
-  if (elf != NULL)
-  {
-    Dwarf_Error error = NULL;
-
-    if (dwarf_elf_init_b (elf, DW_DLC_READ, DW_GROUPNUMBER_ANY,
-          gum_on_dwarf_error, NULL, &dbg, &error) != DW_DLV_OK)
-    {
-      dwarf_dealloc (dbg, error, DW_DLA_ERROR);
-      error = NULL;
-    }
-  }
 
   entry = g_slice_new (GumModuleEntry);
   entry->module = module;
@@ -583,7 +572,7 @@ static void
 gum_module_entry_free (GumModuleEntry * entry)
 {
   if (entry->dbg != NULL)
-    dwarf_finish (entry->dbg, NULL);
+    dwarf_finish (entry->dbg);
 
   if (entry->elf != NULL)
     elf_end (entry->elf);
diff --git a/meson.build b/meson.build
index 7040ca6f..9e81e11d 100644
--- a/meson.build
+++ b/meson.build
@@ -483,7 +483,7 @@ if host_os_family in ['linux', 'freebsd', 'qnx']
     endif
   endif
 
-  libdwarf_dep = dependency('libdwarf', required: false, version: ['>= 0.1', '< 0.2'])
+  libdwarf_dep = dependency('libdwarf', required: false, version: ['>= 0.2', '< 0.3'])
   if not libdwarf_dep.found()
     found = false
     if not meson.is_cross_build()
-- 
2.42.0

