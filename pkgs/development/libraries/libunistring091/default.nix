{
  fetchurl,
  lib,
  stdenv,
  libiconv,
  updateAutotoolsGnuConfigScriptsHook,
  darwin
}:

# Note: this package is used for bootstrapping fetchurl, and thus
# cannot use fetchpatch! All mutable patches (generated by GitHub or
# cgit) that are needed here should be included directly in Nixpkgs as
# files.

stdenv.mkDerivation (finalAttrs: {
  pname = "libunistring091";
  version = "0.9.10";

  src = fetchurl {
    url = "mirror://gnu/libunistring/libunistring-${finalAttrs.version}.tar.gz";
    hash = "sha256-/W1WYvpwZIfEg0mnWLV7wUnOlOxsMGJOyf3Ec86rvI4=";
  };

  outputs = [
    "out"
    "dev"
    "info"
    "doc"
  ];

  strictDeps = true;
  propagatedBuildInputs = lib.optional (!stdenv.isLinux) libiconv;
  buildInputs = lib.optionals stdenv.isDarwin [
    darwin.apple_sdk.frameworks.CoreServices
  ];
  nativeBuildInputs = [ updateAutotoolsGnuConfigScriptsHook ];

  configureFlags = [ "--with-libiconv-prefix=${libiconv}" ];

  doCheck = false;

  enableParallelChecking = false;
  enableParallelBuilding = true;

  meta = {
    homepage = "https://www.gnu.org/software/libunistring/";

    description = "Unicode string library";

    longDescription = ''
      This downgraded version 0.9.1 of library 'libunistring' provides missing dependencies which is no longer provided in the latest releases.
      Such as: libunistring.so.2
    '';

    license = lib.licenses.lgpl3Plus;

    maintainers = [ ];
    platforms = lib.platforms.all;
  };
})
