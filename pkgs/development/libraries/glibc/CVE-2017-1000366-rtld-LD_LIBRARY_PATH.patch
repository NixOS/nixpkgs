From 4d009d39ac9ede0369e268554a181b428f177a80 Mon Sep 17 00:00:00 2001
Message-Id: <4d009d39ac9ede0369e268554a181b428f177a80.1495998948.git.fweimer@redhat.com>
In-Reply-To: <cover.1495998948.git.fweimer@redhat.com>
References: <cover.1495998948.git.fweimer@redhat.com>
From: Florian Weimer <fweimer@redhat.com>
Date: Sun, 28 May 2017 20:37:40 +0200
Subject: [PATCH 1/3] rtld: Completely ignore LD_LIBRARY_PATH for AT_SECURE=1
 programs
To: libc-alpha@sourceware.org

LD_LIBRARY_PATH can only be used to reorder system search paths, which
is not useful functionality.
---
 elf/rtld.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/elf/rtld.c b/elf/rtld.c
index 319ef06..824b6cf 100644
--- a/elf/rtld.c
+++ b/elf/rtld.c
@@ -2419,7 +2419,8 @@ process_envvars (enum mode *modep)
 
 	case 12:
 	  /* The library search path.  */
-	  if (memcmp (envline, "LIBRARY_PATH", 12) == 0)
+	  if (!__libc_enable_secure
+	      && memcmp (envline, "LIBRARY_PATH", 12) == 0)
 	    {
 	      library_path = &envline[13];
 	      break;
-- 
2.9.4

