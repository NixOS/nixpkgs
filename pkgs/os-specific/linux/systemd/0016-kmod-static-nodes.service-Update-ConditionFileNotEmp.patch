From 186499cf384ab24397a858e6f4826ab02d4a24ac Mon Sep 17 00:00:00 2001
From: Florian Klink <flokli@flokli.de>
Date: Sat, 7 Mar 2020 22:40:27 +0100
Subject: [PATCH 16/19] kmod-static-nodes.service: Update ConditionFileNotEmpty

kmod loads modules from not only /lib/modules but also from
/run/booted-system/kernel-modules/lib/modules and
/run/current-system/kernel-modules/lib/module

Co-authored-by: Arian van Putten <arian.vanputten@gmail.com>
---
 units/kmod-static-nodes.service.in | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/units/kmod-static-nodes.service.in b/units/kmod-static-nodes.service.in
index f4170d6a99..5e8dc318b1 100644
--- a/units/kmod-static-nodes.service.in
+++ b/units/kmod-static-nodes.service.in
@@ -12,7 +12,9 @@ Description=Create list of static device nodes for the current kernel
 DefaultDependencies=no
 Before=sysinit.target systemd-tmpfiles-setup-dev.service
 ConditionCapability=CAP_SYS_MODULE
-ConditionFileNotEmpty=/lib/modules/%v/modules.devname
+ConditionFileNotEmpty=|/lib/modules/%v/modules.devname
+ConditionFileNotEmpty=|/run/booted-system/kernel-modules/lib/modules/%v/modules.devname
+ConditionFileNotEmpty=|/run/current-system/kernel-modules/lib/modules/%v/modules.devname
 
 [Service]
 Type=oneshot
-- 
2.29.3

