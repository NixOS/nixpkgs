diff -rc kvm-57-orig/qemu/vl.c kvm-57/qemu/vl.c
*** kvm-57-orig/qemu/vl.c	2007-12-18 16:57:46.000000000 +0100
--- kvm-57/qemu/vl.c	2008-03-11 16:17:26.000000000 +0100
***************
*** 3865,3872 ****
      fclose(f);
      atexit(smb_exit);
  
      snprintf(smb_cmdline, sizeof(smb_cmdline), "%s -s %s",
!              SMBD_COMMAND, smb_conf);
  
      slirp_add_exec(0, smb_cmdline, 4, 139);
  }
--- 3865,3875 ----
      fclose(f);
      atexit(smb_exit);
  
+     char *smbd_command = getenv("QEMU_SMBD_COMMAND");
+     if (!smbd_command) smbd_command = SMBD_COMMAND;
+ 
      snprintf(smb_cmdline, sizeof(smb_cmdline), "%s -s %s",
!              smbd_command, smb_conf);
  
      slirp_add_exec(0, smb_cmdline, 4, 139);
  }
Only in kvm-57/qemu: vl.c~
