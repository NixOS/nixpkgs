From f5df3d739a56b42c2544f9c1901a1febc383ca01 Mon Sep 17 00:00:00 2001
From: Will Owens <ghthor@gmail.com>
Date: Wed, 24 Apr 2024 10:28:10 -0400
Subject: [PATCH] nix-build: use nix native llama-cpp package

---
 crates/llama-cpp-bindings/build.rs | 11 ++---------
 1 file changed, 2 insertions(+), 9 deletions(-)

diff --git a/crates/llama-cpp-bindings/build.rs b/crates/llama-cpp-bindings/build.rs
index 8c0da8a7..d55e5a9f 100644
--- a/crates/llama-cpp-bindings/build.rs
+++ b/crates/llama-cpp-bindings/build.rs
@@ -3,19 +3,12 @@ use std::{env, path::Path};
 use cmake::Config;
 
 fn main() {
-    const LLAMA_CMAKE_PATH: &str = "llama.cpp/CMakeLists.txt";
-
-    assert!(
-        Path::new(LLAMA_CMAKE_PATH).exists(),
-        "Please init submodules with `git submodule update --init --recursive` and try again"
-    );
-
     println!("cargo:rerun-if-changed=include/engine.h");
     println!("cargo:rerun-if-changed=src/engine.cc");
+    println!("cargo:rustc-link-search=native={}", env::var("LLAMA_CPP_LIB").unwrap());
     println!("cargo:rustc-link-lib=llama");
-    println!("cargo:rustc-link-lib=ggml_static");
+    println!("cargo:rustc-link-lib=ggml_shared");
 
-    build_llama_cpp();
     build_cxx_binding();
 }
 
-- 
2.44.0

