From e03d7653823d2f6903f795ce30515088241054c3 Mon Sep 17 00:00:00 2001
From: embr <git@liclac.eu>
Date: Mon, 12 Aug 2024 19:06:57 +0200
Subject: [PATCH] Use full Perl path

Based on this patch by PoweredByPie: https://github.com/NixOS/nixpkgs/blob/33c8b1a7202d4c22d74f4db73666e9a868069d2c/pkgs/by-name/ka/kakoune-lsp/Use-full-Perl-path.patch
---
 rc/lsp.kak | 13 ++-----------
 1 file changed, 2 insertions(+), 11 deletions(-)

diff --git a/rc/lsp.kak b/rc/lsp.kak
index 306b405..78e9374 100644
--- a/rc/lsp.kak
+++ b/rc/lsp.kak
@@ -280,12 +280,8 @@ define-command -hidden lsp-menu -params 1.. %{
 }
 define-command -hidden lsp-menu-impl %{
     evaluate-commands %sh{
-        if ! command -v perl > /dev/null; then
-            echo "lsp-show-error %{'perl' must be installed to use the 'lsp-menu' command}"
-            exit
-        fi
         echo >$kak_command_fifo "echo -to-file $kak_response_fifo -quoting kakoune -- %reg{a}"
-        perl < $kak_response_fifo -we '
+        @perlPath@/bin/perl < $kak_response_fifo -we '
             use strict;
             my $Q = "'\''";
             my @args = ();
@@ -2467,11 +2463,6 @@ define-command -hidden lsp-snippets-insert-completion -params 1 %{ evaluate-comm
 }}
 
 define-command lsp-snippets-insert -hidden -params 1 %[
-    evaluate-commands %sh{
-        if ! command -v perl > /dev/null; then
-            printf "fail %{'perl' must be installed to use the 'lsp-snippets-insert' command'}"
-        fi
-    }
     evaluate-commands -draft -save-regs '^"' %[
         set-register '"' %arg{1}
         execute-keys <a-P>
@@ -2526,7 +2517,7 @@ define-command lsp-snippets-insert -hidden -params 1 %[
 define-command -hidden lsp-snippets-insert-perl-impl %[
     set-register x nop
     evaluate-commands %sh[ # $kak_quoted_selections
-        perl -e '
+        @perlPath@/bin/perl -e '
 use strict;
 use warnings;
 use Text::ParseWords();
-- 
2.45.1

