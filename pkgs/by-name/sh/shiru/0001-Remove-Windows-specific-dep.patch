From 57103351d1c10d6aea2432943a12e07b8b88b08a Mon Sep 17 00:00:00 2001
From: Naomi Roberts <mia@naomieow.xyz>
Date: Thu, 4 Dec 2025 19:59:48 +0000
Subject: [PATCH] Remove Windows-specific dep

Signed-off-by: Naomi Roberts <mia@naomieow.xyz>
---
 electron/package.json       |  1 -
 electron/src/main/app.js    | 17 +----------------
 electron/webpack.config.cjs |  4 +---
 package.json                |  1 -
 pnpm-lock.yaml              | 16 ----------------
 5 files changed, 2 insertions(+), 37 deletions(-)

diff --git a/electron/package.json b/electron/package.json
index d3b6228b..3dfa1968 100644
--- a/electron/package.json
+++ b/electron/package.json
@@ -26,7 +26,6 @@
     "webpack-merge": "^6.0.1"
   },
   "dependencies": {
-    "@paymoapp/electron-shutdown-handler": "^1.1.2",
     "@xhayper/discord-rpc": "^1.3.0",
     "concurrently": "^9.2.1",
     "jimp": "0.22.12",
diff --git a/electron/src/main/app.js b/electron/src/main/app.js
index 7959ab6d..6e87d797 100644
--- a/electron/src/main/app.js
+++ b/electron/src/main/app.js
@@ -6,7 +6,6 @@ import Jimp from 'jimp'
 import fs from 'fs'
 
 import { BrowserWindow, MessageChannelMain, Notification, Tray, Menu, nativeImage, app, dialog, ipcMain, powerMonitor, shell, session } from 'electron'
-import electronShutdownHandler from '@paymoapp/electron-shutdown-handler'
 
 import { development } from './util.js'
 import Discord from './discord.js'
@@ -126,21 +125,7 @@ export default class App {
       notification.show()
     })
 
-    if (process.platform === 'win32') {
-      app.setAppUserModelId('com.github.rockinchaos.shiru')
-      // this message usually fires in dev-mode from the parent process
-      process.on('message', data => {
-        if (data === 'graceful-exit') this.destroy()
-      })
-      electronShutdownHandler.setWindowHandle(this.mainWindow.getNativeWindowHandle())
-      electronShutdownHandler.blockShutdown('Saving torrent data...')
-      electronShutdownHandler.on('shutdown', async () => {
-        await this.destroy()
-        electronShutdownHandler.releaseShutdown()
-      })
-    } else {
-      process.on('SIGTERM', () => this.destroy())
-    }
+    process.on('SIGTERM', () => this.destroy())
 
     this.mainWindow.loadURL(development ? 'http://localhost:5000/app.html' : `file://${join(__dirname, '/app.html')}`)
 
diff --git a/electron/webpack.config.cjs b/electron/webpack.config.cjs
index 83d202bc..a7ec5627 100644
--- a/electron/webpack.config.cjs
+++ b/electron/webpack.config.cjs
@@ -69,9 +69,7 @@ module.exports = [
       path: join(__dirname, 'build'),
       filename: 'main.js'
     },
-    externals: {
-      '@paymoapp/electron-shutdown-handler': 'require("@paymoapp/electron-shutdown-handler")'
-    },
+    externals: {},
     resolve: {
       aliasFields: [],
       alias: {
diff --git a/package.json b/package.json
index b74d8391..22735493 100644
--- a/package.json
+++ b/package.json
@@ -48,7 +48,6 @@
       "rfdc": "patches/rfdc.patch"
     },
     "onlyBuiltDependencies": [
-      "@paymoapp/electron-shutdown-handler",
       "bufferutil",
       "electron",
       "fs-native-extensions",
diff --git a/pnpm-lock.yaml b/pnpm-lock.yaml
index d13d3475..d704f875 100644
--- a/pnpm-lock.yaml
+++ b/pnpm-lock.yaml
@@ -251,9 +251,6 @@ importers:
 
   electron:
     dependencies:
-      '@paymoapp/electron-shutdown-handler':
-        specifier: ^1.1.2
-        version: 1.1.2
       '@xhayper/discord-rpc':
         specifier: ^1.3.0
         version: 1.3.0(bufferutil@4.0.8)(utf-8-validate@6.0.4)
@@ -860,9 +857,6 @@ packages:
     engines: {node: ^12.13.0 || ^14.15.0 || >=16.0.0}
     deprecated: This functionality has been moved to @npmcli/fs
 
-  '@paymoapp/electron-shutdown-handler@1.1.2':
-    resolution: {integrity: sha512-/MIC+wdRlVw1Sm56qJcT17O/KBpQARP2tOcAgg1OKB4W83B9IyBBtIoLXkRlpCOEJnGEleuv5HiSBryUgwbFvQ==}
-
   '@pkgjs/parseargs@0.11.0':
     resolution: {integrity: sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==}
     engines: {node: '>=14'}
@@ -3936,9 +3930,6 @@ packages:
   node-addon-api@4.3.0:
     resolution: {integrity: sha512-73sE9+3UaLYYFmDsFZnqCInzPyh3MqIwZO9cw58yIqAZhONrrabrYyYe3TuIqtIiOuTXVhsGau8hcrhhwSsDIQ==}
 
-  node-addon-api@5.1.0:
-    resolution: {integrity: sha512-eh0GgfEkpnoWDq+VY8OyvYhFEzBk6jIYbRKdIlyTiAXIVJ8PyBaKb0rp7oDtoddbdoHWhq8wwr+XZ81F1rpNdA==}
-
   node-addon-api@6.1.0:
     resolution: {integrity: sha512-+eawOlIgy680F0kBzPUNFhMZGtJ1YmqM6l4+Crf4IkImjYrO/mqPwRMh352g23uIaQKFItcQ64I7KMaJxHgAVA==}
 
@@ -6709,11 +6700,6 @@ snapshots:
       mkdirp: 1.0.4
       rimraf: 3.0.2
 
-  '@paymoapp/electron-shutdown-handler@1.1.2':
-    dependencies:
-      node-addon-api: 5.1.0
-      prebuild-install: 7.1.2
-
   '@pkgjs/parseargs@0.11.0':
     optional: true
 
@@ -10356,8 +10342,6 @@ snapshots:
 
   node-addon-api@4.3.0: {}
 
-  node-addon-api@5.1.0: {}
-
   node-addon-api@6.1.0: {}
 
   node-api-version@0.2.1:
-- 
2.51.2

