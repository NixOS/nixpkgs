{stdenv, fetchurl, perl, m4, gcc}:

assert perl != null && m4 != null;

stdenv.mkDerivation {
  name = "uml-2.4.27-1";
  builder = ./builder.sh;
  src = fetchurl {
    url = ftp://ftp.nl.kernel.org/pub/linux/kernel/v2.4/linux-2.4.27.tar.bz2;
    md5 = "59a2e6fde1d110e2ffa20351ac8b4d9e";
  };
  umlPatch = fetchurl {
    url = http://heanet.dl.sourceforge.net/sourceforge/user-mode-linux/uml-patch-2.4.27-1.bz2;
    md5 = "63178bbd3a383a1005738f4628ff583e";
  };
  noAioPatch = ./no-aio.patch;
#  hostfsPatch = ./hostfs.patch;
#  hostfsAccessPatch = ./hostfs-access.patch;
  config = ./config;
  buildInputs = [perl m4];
  NIX_GCC = gcc;
}
