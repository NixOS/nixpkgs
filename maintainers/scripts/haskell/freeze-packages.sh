#!/usr/bin/env bash

here="$(dirname "$0")"
config="$(nix-build --no-out-link "$here/frozen-packages-config.nix")"
target="$here/../../../pkgs/development/haskell-modules/configuration-hackage2nix/frozen-packages.yaml"

echo "Writing $target"
cp "$config" "$target"

if [[ "${1:-}" == "--do-commit" ]]; then
    git add "$target"
    git commit -F - << EOF
haskellPackages: freeze package set

This commit has been generated by maintainers/scripts/haskell/freeze-packages.sh
EOF
fi
